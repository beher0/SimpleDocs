import Image from '@/components/Image';
import {Callout} from 'nextra/components';
import {Tab, Tabs} from 'nextra/components';

# éƒ¨ç½²

å¦‚æœæ‚¨å¹¶æ²¡æœ‰ç›´æ¥å…‹éš† SimpleLife é¡¹ç›®ï¼Œéœ€è¦æŒ‰ç…§éƒ¨ç½²æ–‡æ¡£ä¸€æ­¥ä¸€æ­¥è®¾ç½®ã€‚å…¶ä¸­æ¯”è¾ƒåŸºç¡€çš„éƒ¨ç½²èƒ½åŠ›ï¼Œå¦‚å°†é¡¹ç›®ä¸Šä¼ åˆ° Github ä»“åº“ï¼Œå¹¶ä¸ä¼šæåŠã€‚

## GitHub Actions

<Callout>
  å¸Œæœ›æ‚¨çš„Githubé¡¹ç›®æ˜¯Publicï¼Œä¸ç„¶ä½ å°†æ— æ³•å…è´¹ä½¿ç”¨GitHub Actions
</Callout>
GitHub Actions æ˜¯ä¸€ç§å·¥å…·ï¼Œå¯è®©ä½ åœ¨ GitHub ä»“åº“ä¸­æ‰§è¡Œä¸åŒçš„è‡ªåŠ¨åŒ–æ“ä½œ

å®ƒå…è®¸ä½ åˆ›å»ºè‡ªå®šä¹‰å·¥ä½œæµï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥ä½œæµæ¥è‡ªåŠ¨åŒ–å¼€å‘è¿‡ç¨‹ï¼Œä¾‹å¦‚æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ä»£ç 

<Image src='/images/actions.png' />

GitHub Actions çš„é…ç½®æ–‡ä»¶å«åš workflow æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ä»£ç ä»“åº“çš„`.github/workflows`ç›®å½•

workflow æ–‡ä»¶é‡‡ç”¨`YAML`æ ¼å¼, æ–‡ä»¶åå¯ä»¥ä»»æ„å–, ä½†æ˜¯åç¼€åç»Ÿä¸€ä¸º.yml, æ¯”å¦‚`config.yml`

ä¸€ä¸ªåº“å¯ä»¥æœ‰å¤šä¸ª workflow æ–‡ä»¶, GitHub åªè¦å‘ç°`.github/workflows`ç›®å½•é‡Œé¢æœ‰ \*.yml æ–‡ä»¶, å°±ä¼šè‡ªåŠ¨è¿è¡Œè¯¥æ–‡ä»¶

ç‚¹å‡»`set up a workflow yourself`åˆ›å»º workflow

<Image src='/images/workflow.png' />

```yml copy filename=".github/workflows/config.yml"
name: Actions CI - Next.js version 12 static site export, GitHub Actions Build and Deploy
on:
  push:
    branches: [main]
# æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡
jobs:
  build-and-deploy:
    # è¿è¡Œåœ¨è™šæ‹Ÿæœºç¯å¢ƒubuntu-latest
    # https://docs.github.com/zh/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idruns-on
    runs-on: ubuntu-latest
    steps:
      - name: è·å–æºç   ğŸ›ï¸
        uses: actions/checkout@v3
      - name: Nodeç¯å¢ƒç‰ˆæœ¬ ğŸ—œï¸
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: å®‰è£… Pnpm ğŸ§¬
        uses: pnpm/action-setup@v2
        id: pnpm-install
        with:
          version: 7
          run_install: true
      - name: å®‰è£…ä¾èµ– âš™ï¸
        run: pnpm install
      - name: æ‰“åŒ… ğŸ—ï¸
        run: |
          npm run build
          touch out/.nojekyll
      - name: éƒ¨ç½² ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: out
          clean: true
```

ç‚¹å‡»`Commit changes`æ¥åˆ›å»ºæ”¹æ–‡ä»¶ï¼Œç„¶å`actions`å°±å¼€å§‹è‡ªåŠ¨åŒ–è¿è¡Œäº†

åœ¨é…ç½®`workflow`ä¼šå‡ºç°ä¸€ä¸‹é—®é¢˜ï¼Œä¸‹é¢å°†å¸¦ä½ ä¸€æ­¥æ­¥å‰–æé—®é¢˜å’Œè§£å†³é—®é¢˜
ç‚¹å‡»`build-and-deploy`æŸ¥çœ‹é”™è¯¯æ—¥å¿—

<Image src='/images/build_deploy.png' />

### Bug1

<Tabs items={["bugå›¾","åŸå› ","è§£å†³æ–¹æ¡ˆ"]}>
  <Tab>
    <Image src='/images/yml_bug1.png' />
  </Tab>
  <Tab>
    è¯¥æŠ¥é”™è¡¨ç¤ºæœªé…ç½®æ‰“åŒ…å‘½ä»¤
  </Tab>
  <Tab>
    ```js copy filename="package.json" {3}
    "scripts": {
      "dev": "next dev",
      "build": "next build"
    },
    ```
  </Tab>
</Tabs>

### Bug2

<Tabs items={["bugå›¾","åŸå› ","è§£å†³æ–¹æ¡ˆ"]}>
  <Tab>
    <Image src='/images/yml_bug2.png' />
  </Tab>
  <Tab>
    è¯¥æŠ¥é”™è¡¨ç¤ºæ‰¾ä¸åˆ°`out`æ–‡ä»¶å¤¹ï¼Œæ‚¨éœ€è¦é…ç½®æ‰“åŒ…åè¾“å‡ºçš„é™æ€æ–‡ä»¶ï¼Œæ‰“åŒ…åˆ°`out`æ–‡ä»¶å¤¹
  </Tab>
  <Tab>
    ```js copy filename="next.config.js" {6-8}
    const withNextra = require('nextra')({
      theme: 'nextra-theme-docs',
      themeConfig: './theme.config.jsx',
    });

    const nextConfig = {
      output: 'export',
    };

    module.exports = withNextra(nextConfig);
    ```

  </Tab>
</Tabs>

### Bug3

<Tabs items={["bugå›¾","åŸå› ","è§£å†³æ–¹æ¡ˆ"]}>
  <Tab>
    <Image src='/images/yml_bug3.png' />
  </Tab>
  <Tab>
  <Image src='/images/fixed_bug3.png' />
  </Tab>
  <Tab>
    ```js copy filename="next.config.js" {3-5}
    const nextConfig = {
      output: 'export',
      images: {
        unoptimized: true,
      },
    }
    ```
  </Tab>
</Tabs>

### Bug4

<Tabs items={['bugå›¾', 'åŸå› ', 'è§£å†³æ–¹æ¡ˆ']}>
  <Tab>
    <Image src='/images/yml_bug4.png' />
  </Tab>
  <Tab>workflow permissionsæƒé™ä¸è¶³</Tab>
  <Tab>
    è§£å†³æ–¹æ¡ˆ: ä¿®æ”¹ workflow permissionsæƒé™ <br />
    åœ¨ Settings > Actions > General ä¸­ Workflow permissions
    <Image src='/images/fixed_bug4.png' />

    è¿›å…¥Actionså°†å¤±è´¥`workflow `é‡æ–°å°±å¥½äº†

  </Tab>
</Tabs>

## GitHub Pages

GitHub Pages å¿…é¡»åœ¨æ¯ä¸ª repo çš„åŸºç¡€ä¸Šæ‰“å¼€, æ‰“å¼€å®ƒæ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦æœåŠ¡çš„åˆ†æ”¯,å°†æœåŠ¡è®¾ç½®åœ¨`.gh-pages`åˆ†æ”¯

åœ¨æµè§ˆå™¨ä¸­, æ‰“å¼€ GitHub é‡Œçš„é¡¹ç›® repo
åœ¨ Settings > Pages > Source ä¸­, å°† Branch åˆ†æ”¯è®¾å®šåœ¨`.gh-pages`å¹¶ç‚¹å‡» Save ä¿å­˜é…ç½®

<Image src='/images/github_pages.png' />

ç­‰å¾… actions éƒ¨ç½²å®Œ Pagesï¼Œå¯ä»¥ç‚¹å‡»`Visit site`è®¿é—®ç«™ç‚¹

<Image src='/images/deploy_pages.png' />

## Next.js

Next.js çš„`next/image`ã€`next/link`å’Œ`next/router`æŒ‡å®šè·¯å¾„æ˜¯ç›¸å¯¹äº /çš„

è€Œ GitHub Pages æ‰˜ç®¡ç«™ç‚¹çš„ URL ä¸º:`https://<ä½ çš„ github name>.github.io/<repo>`

å¦‚: https://simplelifecst.github.io/nextra-template/
æ‰€ä»¥ éœ€è¦é€šè¿‡é…ç½®ä½¿ Next.js å¾—åˆ° `/<repo>`

æœ‰ä¸¤ä¸ªç›¸å…³çš„é…ç½®é€‰é¡¹: `basePath` å’Œ `assetPrefix`

å°† basePath è®¾ç½®ä¸º `/<repo name>` å°†ç”Ÿæˆ GitHub Pages å¯è®¿é—®é“¾æ¥

å°† assetPrefix è®¾ç½®ä¸º `/<repo name>` å°†ç”Ÿæˆ GitHub Pages å¯è®¿é—®å›¾åƒ

æ ¹æ®å¼€å‘ç¯å¢ƒå’Œç”Ÿæˆç¯å¢ƒæ¥åŒºåˆ†è·¯å¾„ï¼Œæ¥ä¿è¯è·¯å¾„çš„æ­£ç¡®æ€§

```js copy filename="next.config.js"
const repo = 'nextra-template';
const isProd = process.env.NODE_ENV === 'production';

const nextConfig = {
  assetPrefix: isProd ? `/${repo}` : '',
  basePath: isProd ? `/${repo}` : '',
};
```

### å®Œæ•´é…ç½®

```js copy filename="next.config.js"
const repo = 'nextra-template';
const isProd = process.env.NODE_ENV === 'production';

const withNextra = require('nextra')({
  theme: 'nextra-theme-docs',
  themeConfig: './theme.config.jsx',
});

const nextConfig = {
  output: 'export',
  images: {
    unoptimized: true,
  },
  assetPrefix: isProd ? `/${repo}` : '',
  basePath: isProd ? `/${repo}` : '',
};

module.exports = withNextra(nextConfig);
```

## ç»“æŸ

å°† NextJS éƒ¨ç½²åˆ° Github Actions ä¹Ÿå°±æ˜¯è¿™ä¹ˆå›äº‹äº†ï¼Œå¦‚æœä½ éœ€è¦éƒ¨ç½²åˆ° Gitee ä¸Šï¼Œåªéœ€è¦å»åŒæ­¥ä»“åº“å°± Ok äº†
